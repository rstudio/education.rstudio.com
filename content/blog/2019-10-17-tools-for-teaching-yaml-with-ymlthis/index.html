---
title: Tools for Teaching YAML with ymlthis
author: Malcolm Barrett
date: '2019-10-17'
slug: tools-for-teaching-yaml-with-ymlthis
categories:
  - teach
tags: []
---



<p>R Markdown is one of the most powerful aspects of the R ecosystem, and it’s also surprisingly intuitive. Markdown itself has a simple syntax, and R Markdown handles so many of the tricky details of document creation that the basics will get you a long way. But there’s one area of R Markdown that consistently trips students up: YAML.</p>
<p>YAML (“Yet Another Markup Language” or “YAML Ain’t Markup Language,” depending on who you ask) is the metadata that tells R Markdown, pandoc, and other software exactly how to process or display the document. But YAML looks and smells differently than R. What’s with this white space? Does this need quotation marks? Where’s the documentation? Why doesn’t this work? Often, the simplest solution is to copy and paste the YAML from older documents. (That’s what I did for a long time. At least I knew it would probably work!)</p>
<p>I spent my <a href="https://blog.rstudio.com/2019/03/25/summer-interns-2019/">summer internship at RStudio</a> trying to reckon with this problem. Work my mentor <a href="https://github.com/rich-iannone">Rich Iannone</a> led to the <a href="https://ymlthis.r-lib.org">ymlthis</a> package (<a href="https://malco.io/2019/10/10/introducing-ymlthis/">now on CRAN!</a>). ymlthis addresses these issues by documenting YAML options for R Markdown and friends, providing R functions to write YAML for you (in the correct syntax!), and providing new ways of working with R Markdown and YAML files.</p>
<p>ymlthis also includes several tools useful for teaching YAML. Three particularly relevant elements are 1) writing YAML chunks for you in a reproducible, safe way, 2) drawing the nested structure underlying YAML, and 3) the YAML Fieldguide, a comprehensive guide to YAML options in the context of R Markdown. The first two are useful for creating teaching materials, while the third is a great place to point students to during exercises or for future reference.</p>
<div id="writing-yaml-with-ymlthis" class="section level1">
<h1>Writing YAML with ymlthis</h1>
<p>One of the main features of ymlthis is that it can write YAML for you.</p>
<pre class="r"><code>library(ymlthis)
yml() %&gt;% 
  yml_output(pdf_document(), html_document()) %&gt;% 
  yml_latex_opts(fontsize = &quot;12pt&quot;)</code></pre>
<pre><code>## ---
## author: Malcolm Barrett
## date: &#39;`r format(Sys.Date())`&#39;
## output:
##   pdf_document: default
##   html_document: default
## fontsize: 12pt
## ---</code></pre>
<p>By default, this simply prints to your console. (You can also write it to files or place it on your clipboard; see the <a href="http://ymlthis.r-lib.org/articles/introduction-to-ymlthis.html">vignette introducing ymlthis</a>). ymlthis includes a function, <code>asis_yaml_output()</code>, that will take the result of <code>yml_*()</code> functions (which all return objects of class <code>yml</code>) and turns them into knitr YAML chunks. YAML chunks display the output as proper YAML (not R output, as above) with correct syntax highlighting. Since ymlthis produces safe, correct YAML, you won’t have to double-guess your teaching materials. For example, <a href="/author/alison/">Alison Hill</a> uses it <a href="https://github.com/rstudio-education/rmd4medicine/blob/master/static/slides/01-rmd-anatomy.Rmd#L412-L422">in her recent workshop, R Markdown for Medicine</a>.</p>
<pre class="r"><code>last_yml() %&gt;% # use the most recent `yml` object
  asis_yaml_output()</code></pre>
<pre class="yaml"><code>---
author: Malcolm Barrett
date: &#39;`r format(Sys.Date())`&#39;
output:
  pdf_document: default
  html_document: default
fontsize: 12pt
---</code></pre>
<p>In an R Markdown document (including slides!), a useful trick is to set a <code>knit_print</code> method for the <code>yml</code> object. Writing <code>knit_print.yml</code> to call <code>asis_yaml_output()</code> and including it in your document will automatically convert all <code>yml</code> objects to YAML chunks.</p>
<pre class="r"><code>knit_print.yml &lt;- function(x, ...) {
  ymlthis::asis_yaml_output(x, ...)
}</code></pre>
</div>
<div id="drawing-the-hierarchy-in-a-yaml-header" class="section level1">
<h1>Drawing the hierarchy in a YAML header</h1>
<p>YAML uses whitespace to specify the relationship between fields. This syntax can be quite confusing for R users since R does not use whitespace in this way. To make these relationships more explicit, <code>draw_yml_tree()</code> takes a <code>yml</code> object and draws the underlying connections between the levels of the metadata.</p>
<p>Let’s consider an example using output functions. The <code>output</code> field takes R functions from the rmarkdown package that specify how to produce the document. The default, for instance is <code>rmarkdown::html_document()</code>. While we don’t usually write it this way, the YAML fields nested underneath the output types are just arguments that get passed to the function you’re using (thus you can see the options by reading the help page for the function, e.g. <code>?rmarkdown::html_document()</code>).</p>
<pre class="r"><code>yml() %&gt;% 
  yml_output(html_document(toc = TRUE, toc_float = TRUE))</code></pre>
<pre><code>## ---
## author: Malcolm Barrett
## date: &#39;`r format(Sys.Date())`&#39;
## output:
##   html_document:
##     toc: true
##     toc_float: true
## ---</code></pre>
<p><code>draw_yml_tree()</code> draws this relationship more clearly.</p>
<pre class="r"><code>draw_yml_tree() # draws the most recent YAML by default</code></pre>
<pre><code>## ├── author: Malcolm Barrett
## ├── date: &#39;`r format(Sys.Date())`&#39;
## └── output:
##     └── html_document:
##         ├── toc: true
##         └── toc_float: true</code></pre>
<p><code>toc</code> and <code>toc_true</code> are <em>nested</em> under <code>html_document</code>, which is, in turn, nested under <code>output</code>. Here’s the structure for more than one output type:</p>
<pre class="r"><code>yml() %&gt;% 
  yml_output(
    html_document(toc = TRUE, toc_float = TRUE),
    pdf_document()
  ) %&gt;% 
  draw_yml_tree() </code></pre>
<pre><code>## ├── author: Malcolm Barrett
## ├── date: &#39;`r format(Sys.Date())`&#39;
## └── output:
##     ├── html_document:
##     │   ├── toc: true
##     │   └── toc_float: true
##     └── pdf_document: default</code></pre>
<p><code>html_document</code> and <code>pdf_document</code> are both nested under <code>output</code>, while the arguments for <code>html_document</code> are still connect to that function. This also explains why missing whitespace will often produce the wrong results: if we misspecify the whitespace, we misspecify the structure of the metadata. Let’s say we write some YAML that looks like this, where both <code>toc</code> and <code>toc_float</code> have the wrong indentation:</p>
<pre class="yaml"><code>---
output:
    html_document:
    toc: true
toc_float: true
---</code></pre>
<p>This document won’t render correctly, because the YAML has this underlying structure:</p>
<pre class="r"><code>&quot;output:
    html_document:
    toc: true
toc_float: true&quot; %&gt;% 
  as_yml() %&gt;% 
  draw_yml_tree()</code></pre>
<pre><code>## ├── output:
## │   ├── html_document: null
## │   └── toc: true
## └── toc_float: true</code></pre>
<p>R Markdown doesn’t know that <code>toc</code> and <code>toc_float</code> are related to <code>html_document()</code>. It thinks the value of <code>html_document</code> is <code>NULL</code>! This particular example even renders (because, although <code>toc</code> is not an output function, R Markdown only evaluates <code>html_document</code>). Whitespace errors like these often fail silently.</p>
</div>
<div id="the-yaml-fieldguide" class="section level1">
<h1>The YAML Fieldguide</h1>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="ymlthis_fieldguide.jpeg" alt="The YAML Fieldguide and the types of YAML documented therein. Image by Mara Averick" width="75%" />
<p class="caption">
Figure 1: The YAML Fieldguide and the types of YAML documented therein. Image by Mara Averick
</p>
</div>
<p>The final resource I want to talk about is one of the most straightforward but most useful: documentation. YAML that we use for R Markdown is documented in many ways across many pieces of software. It’s often hard to dig up what the options are. A benefit of using R functions to write YAML is that each field is documented in the function’s help page. But ymlthis goes one step further: <a href="http://ymlthis.r-lib.org/articles/yaml-fieldguide.html">the YAML Fieldguide</a>, one of the three vignettes included in ymlthis, aggregates every YAML option documented in the package, organized by source Because the options are in a single place, they are easily searchable. They also link back to the help pages for more information.</p>
<p>The Fieldguide thus provides a comprehensive source for finding options to set in YAML and understanding what valid values are.</p>
</div>
<div id="learn-more" class="section level1">
<h1>Learn More</h1>
<p>The ymlthis package is still early in its lifecycle, but it can already do a lot, including writing R Markdown and YAML files, creating ad-hoc templates, and creating new R Markdown files using an add-in that helps you write your YAML. <a href="https://ymlthis.r-lib.org/">See the package website</a> for more. Of particular use may be its three vignettes:</p>
<ul>
<li><a href="https://ymlthis.r-lib.org/articles/introduction-to-ymlthis.html">An Introduction to ymlthis</a></li>
<li><a href="https://ymlthis.r-lib.org/articles/yaml-overview.html">YAML: an Overview</a></li>
<li><a href="https://ymlthis.r-lib.org/articles/yaml-fieldguide.html">The YAML Fieldguide</a></li>
</ul>
</div>
